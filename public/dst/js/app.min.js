angular.module("app.config",[]).value("OWM_API_KEY","1ba7401f0fd8de8800f868d0400afc44"),angular.module("app.routes",[]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/map"),a.state("map",{url:"/map",templateUrl:"./views/ol3-map.html",controller:"MapCtrl as map"})}]);var app=angular.module("app",["ui.router","app.config","app.routes","map.ctrl","cities.service","weather.data.service"]);angular.module("map.ctrl",["openlayers-directive"]).controller("MapCtrl",["Cities","WeatherData",function(a,b){function c(a){return{image:{icon:{anchorXUnits:"fraction",anchorYUnits:"fraction",scale:1,anchor:[.5,.95],opacity:.9,src:b.getWeatherIconUrl(a)}}}}function d(){e.markers=[],b.getWeatherById(a.toString(a.all())).then(function(a){for(var b=a.list,d=0;d<b.length;d++){var f={};f.name=b[d].name,f.lat=b[d].coord.lat,f.lon=b[d].coord.lon,f.weather=b[d].weather[0];var g=Math.round(b[d].main.temp);f.label={show:!0,message:g+" Â°C | <b>"+f.name+"</b>"},f.style=c(f.weather.icon),e.markers.push(f)}},function(a){console.log("Error "+a)})}var e=this;e.primorye={lat:45.3,lon:134.6,zoom:6},e.layers=[{name:"OpenStreetMap",active:!0,source:{type:"OSM"}}],d()}]),angular.module("cities.service",[]).factory("Cities",[function(){return{all:function(){return[{id:"2013348",name:"Vladivostok"}]},toString:function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].id,c<a.length-1&&(b+=",");return b}}}]),angular.module("weather.data.service",[]).factory("WeatherData",["OWM_API_KEY","$http",function(a,b){var c="http://api.openweathermap.org/data/2.5/",d="http://openweathermap.org/img/w/";return{getWeatherById:function(d){return b.get(c+"group?id="+d+"&units=metric&appid="+a).then(function(a){return a.data})},getForecastById:function(d){return b.get(c+"weather?id="+d+"&units=metric&appid="+a).then(function(a){return a.data})},getWeatherIconUrl:function(a){return d+a+".png"}}}]);