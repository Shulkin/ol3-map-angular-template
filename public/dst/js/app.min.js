angular.module("app.config",[]).value("OWM_API_KEY","1ba7401f0fd8de8800f868d0400afc44"),angular.module("app.routes",[]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/map"),a.state("map",{url:"/map",templateUrl:"./views/ol3-map.html",controller:"MapCtrl as map"})}]);var app=angular.module("app",["ui.router","app.config","app.routes","map.ctrl","cities.service","weather.data.service"]);angular.module("map.ctrl",["openlayers-directive"]).controller("MapCtrl",["Cities","WeatherData",function(a,b){function c(){d.markers=[],b.getWeatherById(a.toString(a.all())).then(function(a){for(var b=a.list,c=0;c<b.length;c++){var e={};e.name=b[c].name,e.lat=b[c].coord.lat,e.lon=b[c].coord.lon,e.weather=b[c].weather[0];var f=Math.round(b[c].main.temp);e.label={show:!0,message:f+" Â°C | <b>"+e.name+"</b>"};var g="01d.png";e.style={image:{icon:{anchor:[.5,.95],anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:.9,src:"http://openweathermap.org/img/w/"+g}}},d.markers.push(e)}},function(a){console.log("Error "+a)})}var d=this;d.primorye={lat:45.3,lon:134.6,zoom:6},d.layers=[{name:"OpenStreetMap",active:!0,source:{type:"OSM"}}],c()}]),angular.module("cities.service",[]).factory("Cities",[function(){return{all:function(){return[{id:"2013348",name:"Vladivostok"}]},toString:function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].id,c<a.length-1&&(b+=",");return b}}}]),angular.module("weather.data.service",[]).factory("WeatherData",["OWM_API_KEY","$http",function(a,b){var c="http://api.openweathermap.org/data/2.5/";return{getWeatherById:function(d){return b.get(c+"group?id="+d+"&units=metric&appid="+a).then(function(a){return a.data})},getForecastById:function(d){return b.get(c+"weather?id="+d+"&units=metric&appid="+a).then(function(a){return a.data})}}}]);